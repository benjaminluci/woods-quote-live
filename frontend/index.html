<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Woods Quoting Assistant</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    html,body { height:100%; margin:0; }
    body { font-family: system-ui, Arial, sans-serif; background:#f6f7f9; display:flex; flex-direction:column; }
    header { padding:12px 16px; background:#111827; color:#fff; }
    #chat { flex:1; overflow:auto; padding:16px; }
    .msg { max-width: 720px; margin: 8px auto; padding: 12px 14px; border-radius: 12px; white-space: pre-wrap; line-height: 1.45; }
    .user { background:#2563eb; color:#fff; margin-left:auto; }
    .bot { background:#fff; border:1px solid #e5e7eb; margin-right:auto; }
    footer { display:flex; gap:8px; padding:12px; background:#fff; border-top:1px solid #e5e7eb; position:sticky; bottom:0; }
    input { flex:1; padding:10px 12px; border-radius:10px; border:1px solid #cbd5e1; outline:none; }
    input:focus { border-color:#111827; }
    button { padding:10px 14px; border-radius:10px; border:1px solid #111827; background:#111827; color:#fff; cursor:pointer; }
    button:disabled { opacity:.6; cursor:not-allowed; }
  </style>
</head>
<body>
  <header>Woods Quoting Assistant</header>
  <div id="chat" aria-live="polite"></div>
  <footer>
    <input id="inp" placeholder="Type: dealer #178647" autocomplete="off" />
    <button id="send">Send</button>
  </footer>

  <script>
    const CHAT_BACKEND = 'https://woods-quote-backend.onrender.com/chat';

    const chat = document.getElementById('chat');
    const inp  = document.getElementById('inp');
    const btn  = document.getElementById('send');

    const sessionId = localStorage.getItem('sessionId')
      || (crypto.randomUUID ? crypto.randomUUID() : String(Math.random()));
    localStorage.setItem('sessionId', sessionId);

    function add(text, who) {
      const div = document.createElement('div');
      div.className = `msg ${who}`;
      div.textContent = text;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }

    async function send() {
      const text = inp.value.trim();
      if (!text) return;
      inp.value = '';
      add(text, 'user');
      add('â€¦', 'bot');
      const thinking = chat.lastChild;

      try {
        const r = await fetch(CHAT_BACKEND, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'X-Session-Id': sessionId },
          body: JSON.stringify({ message: text })
        });
        const data = await r.json();
        thinking.remove();
        add(data.reply || JSON.stringify(data), 'bot');
      } catch (e) {
        thinking.remove();
        add('Error: ' + (e?.message || e), 'bot');
      }
      inp.focus();
    }

    btn.addEventListener('click', send);
    inp.addEventListener('keydown', e => (e.key === 'Enter') && send());
    // Ensure input is focusable even if something else steals focus
    window.addEventListener('load', () => inp.focus(), { once: true });
  </script>
</body>
</html>

